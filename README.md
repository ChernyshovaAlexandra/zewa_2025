# ZEWA 2025 Telegram Mini App

Интерфейс ZEWA 2025 задуман как мини-приложение, запускаемое во встроенном webview Telegram. Этот репозиторий содержит фронтенд, собираемый через Vite и интегрированный с Telegram WebApp API.

## Быстрый старт для разработки

1. Установите зависимости: `npm install` или `pnpm install`.
2. Запустите локальный сервер: `npm run dev`.
3. По умолчанию приложение разрешает запуск в браузере в режиме разработки. Для production-сборки доступ в обычном браузере блокируется, но его можно принудительно разрешить, задав переменную окружения `VITE_ALLOW_BROWSER_MODE=true`.
4. Если нужно автоматически перекидывать пользователя из браузера в Telegram, укажите имя бота и стартовый параметр:
   ```
   VITE_TELEGRAM_BOT_USERNAME=zemma_chatbot
   VITE_TELEGRAM_STARTAPP_PARAM=promo
   ```
   Любая переменная может быть опущена; если задан только `VITE_TELEGRAM_BOT_USERNAME`, будет использоваться ссылка `https://t.me/<bot>?startapp`.

### Полезные команды

- `npm run build` — production-сборка.
- `npm run lint` — линтер (eslint).
- `npm run test` — юнит-тесты (vitest).

## Настройка Telegram Mini App

1. **Домен и HTTPS**
   - Хостинг мини-приложения должен быть доступен по HTTPS-домену.
   - Укажите этот домен в BotFather командой `/setdomain` для вашего бота.

2. **Стартовая кнопка**
   - В меню или инлайн-клавиатуре используйте кнопку типа `web_app`. Пример JSON для инлайн-кнопки:
     ```json
     {
       "text": "Открыть ZEWA 2025",
       "web_app": { "url": "https://your-domain.example/app" }
     }
     ```
   - Обычные URL-кнопки открывают внешний браузер и не работают как мини-приложение.

3. **Проверка запуска**
   - Приложение проверяет наличие `window.Telegram.WebApp` (см. `src/contexts/TelegramContext.tsx`).
   - Если пользователь запускает проект вне Telegram, он увидит уведомление с инструкцией открыть мини-приложение через бот и кнопку с глубоким линком (если заданы переменные окружения).

4. **Глубокая ссылка**
   - Для быстрого открытия можно использовать `https://t.me/<bot_username>?startapp`, если бот поддерживает mini app.

## Как это работает в коде

- `TelegramContext` инициализирует `telegramService`, вызывает `WebApp.ready()` и сохраняет состояние, доступно ли окружение Telegram.
- `App.tsx` показывает контент только после того, как среда определена. Если приложение запущено в обычном браузере (и режим не разрешён переменной `VITE_ALLOW_BROWSER_MODE`), отображается подсказка по запуску в Telegram.
- Для локальной отладки без Telegram добавьте `.env` с `VITE_ALLOW_BROWSER_MODE=true`.
- Для автоматического редиректа в приложение Telegram укажите имя бота в `VITE_TELEGRAM_BOT_USERNAME`; при необходимости добавьте `VITE_TELEGRAM_STARTAPP_PARAM`.

## Дальнейшие шаги перед продакшеном

- Убедитесь, что бекенд обрабатывает запросы, подписанные данными из `webApp.initData`.
- Проверьте домен в BotFather и тип кнопок внутри бота.
- Протестируйте приложение на iOS и Android в официальных клиентах Telegram, чтобы убедиться, что `WebApp` корректно инициализируется и разворачивается в полноэкранный режим.
